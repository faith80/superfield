!function(e){"use strict";AWEContent.Models.Item=Backbone.RelationalModel.extend({hasContentLayout:!1,initialize:function(){},getView:function(){return this.view},createView:function(){this.view=new AWEContent.Views.Item({model:this})},removePanelView:function(){var e,t=this.get("machine_name"),i=AWEContent.Panels[t];i&&i.isOpenned&&i.$el.data("model.id")==this.cid&&(i.$el.removeAttr("data-model.id"),AWEContent.Panels[t].closePanel()),e=this.collection.remove(this,{silent:!0}),e.destroy()},getContentColumnModel:function(){}}),AWEContent.Views.Item=Backbone.View.extend({iframeJQuery:null,tagName:"div",className:"awe-obj",template:_.template('<div class="awe-custom custom-obj">                <ul>                    <li class="cus-res-mode js-edit-hide"><i class="ic ac-icon-eye"></i></li>                    <li class="js-edit-item"><i class="ic ac-icon-edit"></i></li>                    <li class="js-clone-item"><i class="ic ac-icon-clone"></i></li>                    <li class="js-obj-delete"><i class="ic ac-icon-trash"></i></li>                    <li class="js-obj-move"><i class="ic ac-icon-move"></i></li>                    <li class="js-obj-parent-move" style="display: none"><i class="ic ac-icon-move"></i></li>                    </ul>            </div>'),defaultEvents:{"click > .custom-obj > ul > .js-edit-hide":"showHideElement","click > .custom-obj > ul > .js-obj-delete":"deleteItem","click > .custom-obj > ul > .js-edit-item":"editItem","click > .custom-obj > ul > .js-clone-item":"cloneItem"},additionalEvents:{},events:function(){return _.extend({},this.additionalEvents,this.defaultEvents)},initialize:function(){this.iframeJQuery=AWEContent.jqIframe,this.render(),this.listenTo(this.model,"change",this.applySettingsChanged)},render:function(){var t=this,i=this.renderItemContent(),n=i instanceof jQuery?i.get(0):e(i).get(0);if(this.$el.addClass("awe-item-"+this.model.get("machine_name")).addClass("awe-model-"+this.model.cid),this.$el.append(i).append(this.template()),n){var o,a=n.tagName.toLowerCase();e.each(n.classList,function(e,t){a+="."+t}),a=".awe-model-"+this.model.cid+" > "+a,o=setInterval(function(){t.iframeJQuery(a).length&&(clearInterval(o),t.iframeJQuery(a).trigger("itemReady")),t.$el.parents(".awe-section").trigger("resize")},50)}},showHideElement:function(e){var t=AWEContent.Toolbars.responsive.screen;this.model.set(t,!1),AWEContent.Toolbars.responsive.reInitPanel()},renderItemContent:function(){},applySettingsChanged:function(e){},deleteItem:function(){var e=this.$el.parents(".awe-section");this.model.removePanelView(),this.remove(),e.trigger("resize")},editItem:function(){var e=AWEContent.Panels[this.model.get("machine_name")];e.editModel(this.model)},cloneItem:function(){var e=this.model.clone(),t=this.model.collection.indexOf(this.model);this.model.collection.add(e,{at:t+1})},checkChangeHeight:function(e){this.$el.height()!=e&&this.resizeItem()},resizeItem:function(){this.$el.closest(".awe-section").trigger("resize")}}),AWEContent.Collections.ListItem=Backbone.Collection.extend({model:AWEContent.Models.Item}),AWEContent.Views.ListItem=Backbone.View.extend({tagName:"div",className:"awe-col-wrapper",initialize:function(){this.render(),this.initSortable(),this.listenTo(this.collection,"add",this.addItem),this.listenTo(this.collection,"relational:remove",this.removeItem),this.listenTo(this.collection,"all",this.actionChangeCollection)},actionChangeCollection:function(e,t,i){this.$el.trigger("actionChangeCollection",{action:e,model:t,collection:i})},initSortable:function(){AWEContent.jqIframe(this.el).sortable({handle:".js-obj-move",connectWith:".awe-col-wrapper",revert:!0,tolerance:"pointer",placeholder:"awe-item-placeholder",forceHelperSize:!0,forcePlaceholderSize:!0,start:function(t,i){i.item.prepend(e('<div class="awe-item-overlay"></div>').css({position:"absolute",width:"100%",height:"100%","z-index":99})),AWEContent.jqIframe(".awe-col-wrapper",AWEContent.documentIframe).sortable("refreshPositions");var n=e("> .awe-obj",i.item.parent()).index(i.item),o=AWEContent.getColumnModelContainItem(i.item);AWEContent.movedItem=null,i.item.data("sorted-model",o.get("items").at(n)).data("prev-col",o),e(this).closest(".awe-accordion").length&&e.each(i.item.parents(".content-accor"),function(){e(this).css("display","inline")}),AWEContent.iframe.contents().find(".awe-col").addClass("awe-blank"),AWEContent.iframe.contents().find(".awe-item-iframe").prepend('<div class="awe-iframe-overlay"></div>');var a,s;e.each(e(".awe-item",i.item),function(){a=e(this).data("animatename"),s=e(this).data("animateproperty"),e(this).removeClass(a+" "+s)}),e.each(e(".awe-item",i.helper),function(){a=e(this).data("animatename"),s=e(this).data("animateproperty"),e(this).removeClass(a+" "+s)})},stop:function(t,i){e(this).closest(".awe-accordion").length&&e.each(i.item.parents(".content-accor"),function(){e(this).css("display","block")}),AWEContent.iframe.contents().find(".awe-item-iframe .awe-iframe-overlay").remove(),e(".awe-item-overlay",i.item).remove()},update:function(t,i){var n,o=e("> .awe-obj",i.item.parent()).index(i.item),a=i.item.data("sorted-model"),s=i.item.data("prev-col");i.sender||(s.get("items").remove(a,{silent:!0}),n=AWEContent.getColumnModelContainItem(i.item),n.get("items").add(a,{at:o,silent:!0}))}})},render:function(){this.collection.each(function(e){e.createView(),this.$el.append(e.getView().$el)},this)},addItem:function(t,i,n){t.createView();var o=t.getView(),a=e("li.item-element",this.$el);a.length?(o.$el.insertAfter(a),a.remove()):o.$el.insertAfter(e(".awe-obj:eq("+(n.at-1)+")",this.$el)),o.$el.trigger("ready")},removeItem:function(){this.$el.closest(".awe-section").trigger("resize")}}),AWEContent.Views.ItemPanel=AWEContent.Views.DefaultPanel.extend({}),AWEContent.Views.ItemController=Backbone.View.extend({tagName:"li",className:"item-element",machineName:"",existingElement:!1,initialize:function(){this.$el.append(this.controllerHtml()).attr("data-type",this.machineName)},controllerHtml:function(){return""},createItemModel:function(e){return new AWEContent.Models.Item(e)}})}(jQuery);