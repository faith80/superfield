!function(t){"use strict";AWEContent.Views.DefaultPanel=Backbone.View.extend({initialized:!1,editingModel:null,panelName:"",panelEvents:{},events:function(){return t.extend({"click .op-top > .toggle-build":"togglePanel"},this.panelEvents)},initialize:function(){this.isOpenned=!1},addPanelToDoc:function(){this.$el.attr("id",this.panelName+"-panel").data("name",this.panelName),t(".panel-list").append(this.$el)},render:function(t){if(this.panelName){this.$el.append(t.html);var e=document.createElement("script");e.type="text/javascript",e.text=t.js,document.body.appendChild(e)}},initPanel:function(){var e=this;t(".close-panel",this.$el).click(function(t){t.preventDefault(),e.closePanel()}),t(".scroll-bar",this.$el).perfectScrollbar()},setPanelElementsValue:function(){},buildPanel:function(){return{}},editModel:function(t){this.editingModel=t,this.editingModel&&this.$el.data("model.id",t.cid),this.initialized||(this.addPanelToDoc(),this.getPanelHTML()),this.openPanel()},closePanel:function(){this.isOpenned=!1,this.$el.removeClass("opened"),this.$el.hasClass("child-panel")||this.$el.parent().removeClass("opened"),this.editingModel&&AWEContent.contentIframe.find(".awe-model-"+this.editingModel.cid).removeClass("awe-active"),AWEContent.panelsOpened-=1,0==AWEContent.panelsOpened&&(AWEContent.$pageWrapper.removeClass("panel-open"),AWEContent.contentIframe.find(".awe-section").trigger("resize",{closePanel:!0,openPanel:!1}),t(window).trigger("resize"),AWEContent.jqIframe(AWEContent.windowIframe).trigger("resize"))},openPanel:function(){var e=this;if(0==AWEContent.panelsOpened&&(t(window).trigger("resize"),AWEContent.jqIframe(AWEContent.windowIframe).trigger("resize")),AWEContent.panelsOpened+=1,this.initialized)this.setPanelElementsValue();else var a=setInterval(function(){e.initialized&&(clearInterval(a),e.setPanelElementsValue())},100);this.isOpenned=!0,t(".top-index",this.$el.parents(".awe-panel")).removeClass("top-index"),this.$el.hasClass("child-panel")||t(".awe-obj-panel.opened",this.$el.parent()).each(function(){var e=t(this).data("name");AWEContent.Panels[e].closePanel()}),this.$el.addClass("opened top-index"),this.$el.parent().addClass("opened"),this.editingModel&&(AWEContent.contentIframe.find(".awe-active").removeClass("awe-active"),AWEContent.contentIframe.find(".awe-model-"+this.editingModel.cid).addClass("awe-active")),AWEContent.$pageWrapper.addClass("panel-open"),AWEContent.contentIframe.find(".awe-section").trigger("resize",{closePanel:!1,openPanel:!0}),t(".scroll-bar",this.$el).perfectScrollbar("update")},togglePanel:function(t){this.$el.hasClass("opened")?this.closePanel(t):this.openPanel(t)},getPanelHTML:function(){var e=this,a={name:this.panelName,data:this.buildPanel()};this.$el.append('<div class="awe-panel-preload"></div>'),t.post(AWEContent.Path.buildPanel,{panels:JSON.stringify([a])},function(a){if(a)switch(t.type(a)){case"string":a=JSON.parse(a.trim());break;case"object":break;default:a=[]}else a=[];a[e.panelName]&&e.render(a[e.panelName]),e.initPanel(),e.initialized=!0,t(".awe-panel-preload",e.$el).remove()})}}),AWEContent.Views.MediaPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel media-panel",panelName:"mediaPanel",panelEvents:{"click .awe-item-upload":"chooseUploadedFile","click .close-panel":"closePanel","click .js-select-lib-media":"chooseLibraryFile"},initPanel:function(){AWEContent.Views.DefaultPanel.prototype.initPanel.call(this);var e=this;t(".library",e.el).data({initialized:0}),t(".md-tab",this.$el).tabs({active:0,activate:function(e,a){t("> .library",a.newPanel).data("url")&&!t("> .library",a.newPanel).data("initialized")&&t("> .library",a.newPanel).aweLibraryInit()}})},openPanel:function(){AWEContent.Views.DefaultPanel.prototype.openPanel.call(this),t(".awe-buildzone").addClass("overlay-iframe"),t(".awe-item-upload",this.$el).remove()},closePanel:function(){AWEContent.Views.DefaultPanel.prototype.closePanel.call(this),t(".awe-buildzone").removeClass("overlay-iframe")},changeMediaFile:function(e,a){this.editModel(null),this.$controller=e,t(".book-lib ").removeClass("borrowed"),a?(this.multiUpload=1,t(".md-tab",this.$el).data("multi-upload",1)):(this.multiUpload=0,t(".md-tab",this.$el).data("multi-upload",0))},chooseUploadedFile:function(e){var a=t(e.target).hasClass("awe-item-upload")?t(e.target):t(e.target).parents(".awe-item-upload"),n=t("input[name=file_data]",a).val().trim(),i=this.multiUpload?[JSON.parse(n)]:JSON.parse(n);this.$controller.hasClass("awe-background-element")?(t(".img-bg",this.$controller).css("background-image","url("+i.file_url+")"),t("input[name=selected_media]",this.$controller).val(JSON.stringify(i)).trigger("change")):this.$controller.hasClass("thumb-image")?this.$controller.find("input[name=selected_media]").val(JSON.stringify(i)).trigger("change",{action:"library",data:i}):t("input[name=selected_media]",this.$controller).val(JSON.stringify(i)).trigger("change"),this.closePanel()},chooseLibraryFile:function(e){var a=t(".book-lib.borrowed",t(e.target).parent());if(0==a.length)t(".awe-media-message",t(this).parent()).html("No file selected.");else{if(this.multiUpload){var n=[];t.each(a,function(e,a){var i=t("input",this).val().trim();i&&n.push(JSON.parse(i))})}else if(t("input",a).val())var n=JSON.parse(t("input",a).val());this.$controller.hasClass("awe-background-element")?(t(".img-bg",this.$controller).css("background-image","url("+encodeURI(n.file_url)+")"),t("input[name=selected_media]",this.$controller).val(JSON.stringify(n)).trigger("change")):this.$controller.hasClass("thumb-image")?this.$controller.find("input[name=selected_media]").val(JSON.stringify(n)).trigger("change",{action:"library",data:n}):t("input[name=selected_media]",this.$controller).val(JSON.stringify(n)).trigger("change")}this.closePanel()},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Upload</h2></div>'},upload_section:{type:"section",awe_media_upload:{type:"media_upload",upload_url:AWEContent.Path.fileUploadURL,accept_types:["jpg","jpeg","png","gif"],library_options:{url:AWEContent.Path.libraryURL},my_file_options:{url:AWEContent.Path.myFileURL}}}}}}),AWEContent.Views.AttributesPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel attribute-panel",panelName:"customAttributesPanel",attrTemplate:_.template('<div class="item-cus-data">            <div class="aw-norm">                <i class="ic ac-icon-move"></i>                <span class="filldata">                    <span class="dataadd"><%= attr %></span>=”<span class="datavalue"><%= attr_value %></span>”                </span>                <div class="fl-right">                    <span class="edit-cur-data"><i class="ic ac-icon-edit"></i></span>                    <span class="rem-item-data"><i class="ic ac-icon-trash"></i></span>                </div>            </div>            <div class="js-update-attr add-data">                <form>                    <div class="aw-input" style="display: none">                        <label for="awe-update-attr-name-<%= index %>">Value</label>                        <input id="awe-update-attr-name-<%= index %>" type="text" value="<%= attr %>" class="attr-name">                    </div>                    <div class="aw-input">                        <label for="awe-update-attr-value-<%= index %>">Value</label>                        <input id="awe-update-attr-value-<%= index %>" type="text" value="<%= attr_value %>" class="attr-value">                    </div>                </form>                <button class="save-cur-data">Save</button>                <button class="can-item-data">Cancel</button>            </div>        </div>'),panelEvents:{"click .add-attr":"addAttribute","click .edit-cur-data":"editAttrElement","click .rem-item-data":"removeAttrElement","click button.can-item-data":"closeEditAttrForm","click button.save-cur-data":"updateAttrElement"},initPanel:function(){AWEContent.Views.DefaultPanel.prototype.initPanel.call(this);var e=this;t(".cus-datasection",this.$el).sortable({items:".item-cus-data",axis:"y",update:function(){e.changeAttributesData(!0)}})},validateAttrName:function(e){return e.match(/[A-Za-z][-A-Za-z0-9_]*/)&&-1===t.inArray(e,this.dataAtttributes)},changeAttributes:function(e){this.editModel(null);var a=this,n=t("input[name=attributes_data]",this.$controller).val();this.$controller=e,t(".cus-datasection",this.$el).empty(),a.dataAtttributes=[],n&&(n=JSON.parse(n),t.each(n,function(e,n){t(".cus-datasection",a.$el).append(a.attrTemplate({attr:n.attrName,attr_value:n.attrValue,index:e})),a.dataAtttributes.push(n.attrName)}))},addAttribute:function(){var e=t("#awe-add-attr-name",this.$el).val(),a=t("#awe-add-attr-value",this.$el).val(),n=t(".item-cus-data",this.$el).length+1;e&&this.validateAttrName(e)&&a&&(t(".cus-datasection",this.$el).append(this.attrTemplate({attr:e,attr_value:a,index:n})),t("#awe-add-attr-name",this.$el).val(""),t("#awe-add-attr-value",this.$el).val(""),this.dataAtttributes.push(e),this.changeAttributesData(!1,{action:"addAttr",data:{attrName:e,attrValue:a}}))},editAttrElement:function(e){var a=t(e.target).parents(".item-cus-data");t("> .add-data",a).toggleClass("edit")},removeAttrElement:function(e){var a=t("input.attr-name",t(e.target).parents(".item-cus-data")).val();t(e.target).parents(".item-cus-data").remove(),this.changeAttributesData(!1,{action:"rmAttr",data:{attrName:a}})},closeEditAttrForm:function(e){t("> .add-data",t(e.target).parents(".item-cus-data")).removeClass("edit")},updateAttrElement:function(e){var a=t(e.target).parents(".item-cus-data"),n=t("form .attr-name",a).val(),i=t("form .attr-value",a).val();i&&(t("span.datavalue",a).text(i),this.closeEditAttrForm(e),this.changeAttributesData(!1,{action:"updateAttr",data:{attrName:n,attrValue:i}}))},changeAttributesData:function(e,a){var n=[];t(".cus-datasection > .item-cus-data",this.$el).each(function(e,a){var i=t("form input.attr-name",a).val(),l=t("form input.attr-value",a).val();n.push({attrName:i,attrValue:l})}),t("input[name=attributes_data]",this.$controller).val(JSON.stringify(n)),e||t("input[name=attributes_data]",this.$controller).trigger("change",a)},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Custom attributes</h2></div>'},form_section:{type:"section",add_form:{type:"markup",markup:'<div class="add-data"><form><div class="aw-input"><label for="awe-add-attr-value">Name</label><input id="awe-add-attr-name" class="namedata" type="text" placeholder="Attribute name"></div><div class="aw-input"><label for="awe-add-attr-value">Value</label><input id="awe-add-attr-value" class="valdata" type="text" placeholder="Attribute value"></div></form></div><div class="add-attr"><button><i class="ic ac-icon-add"></i>Add attribute</button></div>'}},attributes_section:{type:"section",attributes:{"class":["nobor"]},attr_wrap:{type:"markup",markup:'<div class="cus-datasection"></div>'}}}}}),AWEContent.Views.AnimationPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel animation-panel",panelName:"customAnimationsPanel",panelEvents:{"click .accept-animation":"acceptAnimation","click .pull-open":"previewAnimation","click .cancel-animation":"closePanel"},initPanel:function(){AWEContent.Views.DefaultPanel.prototype.initPanel.call(this);var e=this;this.animationCurrent={},this.animationBefore={},t("#customanimationspanel-animation-list",this.el).change(function(a,n){var i=n.value;t(this).closest(".select-list").nextAll("[data-rx]").hide(),t(this).closest(".select-list").nextAll("[data-rx="+i+"]").show(),"none"==i?t("#customanimationspanel-duration, #customanimationspanel-delay",e.el).hide():t("#customanimationspanel-duration, #customanimationspanel-delay",e.el).show()})},editAnimation:function(e){this.editModel(null),this.$controller=e,this.resetForm();var a=this,n=t("input[name=enabled_custom_animation]",this.$controller).attr("data-animations").trim();switch(this.animationCurrent=n,this.animationBefore=n,this.itemAnimation=n,n=""==n?{type:"none"}:t.parseJSON(n.trim()),t("#customanimationspanel-animation-list",a.el).aweSelect("value",n.type),n.duration&&t("#customanimationspanel-duration",a.el).aweSlider("value",n.duration),n.delay&&t("#customanimationspanel-delay",a.el).aweSlider("value",n.delay),n.type){case"spinin":t("#customanimationspanel-spinin-direction",a.el).aweSelect("value",n.advance.direction),t("#customanimationspanel-spinin-round",a.el).aweSlider("value",n.advance.numberOfSpin);break;case"flyin":t("#customanimationspanel-flyin-options",a.el).aweSelect("value",n.advance);break;case"turnin":t("#customanimationspanel-turnin-direction",a.el).aweSelect("value",n.advance)}},previewAnimation:function(){var e=this,a=t("input[name=enabled_custom_animation]",e.$controller).data("view");e.changeAnimationData(),t("> .awe-item",a.$el).processAnimations(e.animationCurrent,e.animationBefore)},changeAnimationData:function(e){this.animationBefore=this.animationCurrent;var a={},n=t("#customanimationspanel-animation-list input[name=selected_value]",this.el).val(),i=t("#customanimationspanel-duration .display-font",this.el).text(),l=t("#customanimationspanel-delay .display-font",this.el).text(),s=t("[data-rx="+n+"]",this.el);return a.type=n,"none"!=n&&(a.duration=i,a.delay=l),"spinin"!=n&&s.length>0?a.advance=s.find("input[name=selected_value]").val():"spinin"==n&&s.length>0&&(a.advance={direction:t("#customanimationspanel-spinin-direction input[name=selected_value]",this.el).val(),numberOfSpin:t("#customanimationspanel-spinin-round .display-font",this.el).text()}),this.animationCurrent=JSON.stringify(a),a},acceptAnimation:function(e){var a=this.changeAnimationData();t("input[name=enabled_custom_animation]",this.$controller).attr("data-animations",JSON.stringify(a)).trigger("change",{animations:a}),this.closePanel()},closePanel:function(e){AWEContent.Views.DefaultPanel.prototype.closePanel.call(this),e&&t("input[name=enabled_custom_animation]",this.$controller).attr("data-animations",this.itemAnimation)},resetForm:function(){var e=this,a=500,n=0;t("#customanimationspanel-duration",e.el).aweSlider("value",a),t("#customanimationspanel-delay",e.el).aweSlider("value",n),t("#customanimationspanel-flyin-options",e.el).aweSelect("value","top"),t("#customanimationspanel-spinin-direction",e.el).aweSelect("value","clockwise"),t("#customanimationspanel-spinin-round",e.el).aweSlider("value",0),t("#customanimationspanel-turnin-direction",e.el).aweSelect("value","left")},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Appear animation</h2></div>'},animation_section:{type:"section",animation_list:{type:"select",title:"Choose animation",options:{none:"None",expandin:"Expand In",fadein:"Fade In",flyin:"Fly In",spinin:"Spin In",turnin:"Turn In"},default_value:"none"},floatin_options:{type:"select",title:"Float in from",options:{top:"Top",right:"Right",bottom:"Bottom",left:"Left"},default_value:"top",attributes:{"data-rx":"floatin"}},flyin_options:{type:"select",title:"Fly in from",options:{top:"Top",right:"Right",bottom:"Bottom",left:"Left"},default_value:"top",attributes:{"data-rx":"flyin"}},spinin_direction:{type:"select",title:"Direction",options:{clockwise:"Clockwise","counter-clockwise":"Counter clockwise"},default_value:"clockwise",attributes:{"data-rx":"spinin"}},spinin_round:{type:"slider",title:"Number of spin",values:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],default_value:1,allow_type:!1,attributes:{"data-rx":"spinin"}},turnin_direction:{type:"select",title:"Direction",options:{left:"Left",right:"Right"},default_value:"left",attributes:{"data-rx":"turnin"}},preview:{type:"markup",markup:'<div class="pull-open"><span class="title-tag">Preview animation</span><div><i class="ic ac-icon-play"></i></div></div>'},animation_time:{type:"list_box",duration:{type:"slider",title:"Duration",unit:"ms",allow_type:!0,step:100,min_value:0,max_value:1e4,widget:"slider",default_value:"500"},delay:{type:"slider",title:"Delay",unit:"ms",allow_type:!0,min_value:0,max_value:5e3,step:100,widget:"slider",default_value:"0"}},animation_controls:{type:"markup",markup:'<input type="button" class="accept-animation" value="OK"><input type="button" class="cancel-animation" value="Cancel">'}}}}}),AWEContent.Views.FontPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel font-panel",panelName:"fontPanel",panelEvents:{"click ul.fonts-list > li":"chooseFont","mouseover ul.fonts-list > li":"hoverChangeFont"},template:_.template('<li data-value="<%= dataValue %>" class="js-font-select <%= classFont %>">                <span class="font-name"><%= dataValue %></span>            </li>'),initPanel:function(){t(".tab-font .scroll-bar",this.$el).perfectScrollbar(),this.getGoogleFont(),t(".tab-font",this.$el).tabs({active:0})},getGoogleFont:function(){var e=this,a=t(".list-google-font",e.el),n=a.length>0?t(".js-link",a).val().trim().split("="):[],i=n[1]?n[1].split("|"):[],l=t(".fonts-list",a);t.each(i,function(a,n){var i=n.split(":"),s=i[0].replace(/\+/g," "),o=i.length>1?i[1]:"400",r=s.replace(/ /g,"");l.append(t(e.template({dataValue:s,classFont:r})).attr("font-weight",o))}),t(".tab-font .scroll-bar",this.$el).perfectScrollbar("update")},chooseFont:function(e){var a=this,n=t(e.target).hasClass("js-font-select")?t(e.target):t(e.target).closest(".js-font-select"),i=n.data("value"),l=n.attr("font-weight");t("#tab-recent-font .fonts-list",a.$el).append(n.clone()),a.closePanel({name:i,fontStyles:l})},hoverChangeFont:function(e){var a=this,n=t(e.target).hasClass("js-font-select")?t(e.target):t(e.target).closest(".js-font-select"),i=n.data("value");a.$controller.trigger("change",[{name:i,previewFont:!0}])},changeFont:function(t){this.editModel(null),this.$controller=t},buildPanel:function(){return{panel_html:{type:"markup",theme:"ac_panel_font",parameters:{path:window.location.pathname}}}},closePanel:function(t){console.log(this.$controller),console.log(t),this.$controller&&this.$controller.trigger("change",[t]),AWEContent.Views.DefaultPanel.prototype.closePanel.call(this)},getFontData:function(e){var a=t('#tab-all-font li.js-font-select[data-value="'+e+'"]',this.$el);return{name:e,text:t("span.font-name",a).text(),fontWeight:a.attr("font-weight")?a.attr("font-weight"):"400,700"}}}),AWEContent.Views.ListIconsPanel=AWEContent.Views.DefaultPanel.extend({className:"awe-obj-panel child-panel lib-icon-panel",panelName:"listIconPanel",panelEvents:{"click .close-panel":"closePanel","click .item-icon":"selectIcon"},initialize:function(){AWEContent.Views.DefaultPanel.prototype.initialize.call(this)},initPanel:function(){var e=this;t(".control-ok",e.$el).click(function(){e.nameIcon=e.$controller.attr("data-name-icon"),e.closePanel()}),t(".control-cancel",e.$el).click(function(){e.closePanel()}),t(".tab-icon",e.$el).tabs(),t(".scroll-bar",this.$el).perfectScrollbar({})},closePanel:function(){AWEContent.Views.DefaultPanel.prototype.closePanel.call(this),this.$controller.trigger("change",{nameIcon:this.nameIcon})},processIcon:function(t){this.editModel(null),this.$controller=t,this.nameIcon=this.$controller.attr("data-name-icon")},selectIcon:function(e){var a=t(e.target).hasClass("item-icon")?t(e.target):t(e.target).parent(),n=t("i",a).attr("class");this.$controller.attr("data-name-icon",n).trigger("change",{nameIcon:n})},buildPanel:function(){return{panel_html:{type:"markup",theme:"ac_panel_icon"}}}})}(jQuery);