!function(e){"use strict";AWEContent.Models.ColumnSettings=Backbone.RelationalModel.extend({bgImageURL:"",defaults:{customID:"",customClass:"",centerVertical:0,textAlign:"text-left",enableMinHeight:1,minHeight:-1,bgColor:"",bgFid:-1,bgImage:"",bgMode:"repeat",bgPosition:"center center",enableScrolling:0,enabledBgOverlay:0,bgOverlayColor:"",boxModelSettings:{},lgResponsive:!0,xsResponsive:!0,mediumResponsive:!0,smResponsive:!0},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings}]}),AWEContent.Models.BootstrapGrid=Backbone.RelationalModel.extend({defaults:{"col-lg":12,"col-md":12,"col-sm":12,"col-xs":12,"col-lg-offset":0,"col-md-offset":0,"col-sm-offset":0,"col-xs-offset":0,"col-lg-make-row":!1,"col-md-make-row":!1,"col-sm-make-row":!1,"col-xs-make-row":!1}}),AWEContent.Models.Column=Backbone.RelationalModel.extend({defaults:{classes:{},hasLayout:0,layout:[],items:[],settings:{}},relations:[{type:Backbone.HasOne,key:"classes",relatedModel:AWEContent.Models.BootstrapGrid},{type:Backbone.HasOne,key:"settings",relatedModel:AWEContent.Models.ColumnSettings}],clone:function(){var e=new AWEContent.Collections.ListItem,t=new AWEContent.Collections.ListColumn;return this.get("hasLayout")?this.get("layout").each(function(e){t.add(e.clone())}):this.get("items").each(function(t){e.add(t.clone())}),new AWEContent.Models.Column({settings:this.get("settings").toJSON(),classes:this.get("classes").toJSON(),items:e,hasLayout:this.get("hasLayout"),layout:t})},removePanelView:function(){var t=this.toJSON();t.hasLayout?this.get("layout").each(function(e){e.removePanelView()}):e.each(this.get("items").toArray(),function(){this.removePanelView()})}}),AWEContent.Collections.ListColumn=Backbone.Collection.extend({model:AWEContent.Models.Column}),AWEContent.Views.Column=Backbone.View.extend({tagName:"div",className:"awe-col",template:_.template('<div class="awe-custom custom-wrap">                <ul>                    <li class="js-edit-column cus-edit"><i class="ic ac-icon-edit"></i></li>                    <li class="js-split-column cus-split"><i class="ic ac-icon-split"></i></li>                    <li class="js-clone-column cus-clone"><i class="ic ac-icon-clone"></i></li>                    <li class="js-delete-column"><i class="ic ac-icon-trash"></i></li>                    <li class="col-cus-show-more ">                        <i class="ic ac-icon-ellipsis-h"></i>                        <ul class="col-cus-more-contain">                            <li class="js-decrease-offset cus-prev cus-res-mode"><i class="ic ac-icon-moveleft"></i></li>                            <li class="js-increase-offset cus-next cus-res-mode"><i class="ic ac-icon-moveright"></i></li>                            <li class="cus-creat-col js-toggle-layout"><i class="ic ac-icon-sublayout"></i></li>                            <li class="js-make-row cus-res-mode cus-make"><i class="ic ac-icon-newline"></i></li>                            <li class="cus-res-mode js-edit-hide"><i class="ic ac-icon-eye"></i></li>                        </ul>                    </li>                </ul>            </div>            <div class="awe-col-content"></div>'),events:{"click > .custom-wrap > ul > li > ul > .js-increase-offset":"changeOffset","click > .custom-wrap > ul > li > ul > .js-decrease-offset":"changeOffset","click > .custom-wrap > ul > li > ul > .js-edit-hide":"showHideElement","click > .custom-wrap > ul > .js-delete-column":"destroy","click > .custom-wrap > ul > .js-edit-column":"editColumn","click > .custom-wrap > ul > .js-split-column":"splitColumn","click > .custom-wrap > ul > li > ul > .js-make-row":"makeNewRow","click > .custom-wrap > ul > li > ul > .js-toggle-layout":"toggleColumnLayout","click > .custom-add-layout":"addColumnToColumnLayout","click > .custom-wrap > ul > .js-clone-column":"cloneColumn"},initialize:function(){this.render(),this.checkBlankColumn(),this.renderColumnContent(),this.listenTo(this.model.get("settings"),"change",this.renderChangeColumnSettings),this.listenTo(this.model.get("settings").get("boxModelSettings"),"change",this.renderChangeColumnSettings),this.listenTo(this.model.get("classes"),"change",this.renderChangeColumnClasses),this.model.get("hasLayout")||this.listenTo(this.model.get("items"),"all",this.checkBlankColumn),this.$el.bind("getImageURLSuccess",function(e,t){})},processBackgroundURL:function(t,s,l,o){var a=this.model.toJSON().settings,n=o&&o[a.bgFid]&&o[a.bgFid].none?o[a.bgFid].none:"";this.model.bgImageURL=n,this.processBackground(a,e("> .awe-col-content",this.el))},checkBlankColumn:function(){void 0!=this.model.get("items")&&this.model.get("items").length||this.model.get("hasLayout")?this.$el.removeClass("awe-blank"):this.$el.addClass("awe-blank")},initResizable:function(){var t,s,l=this;s=setInterval(function(){var o=AWEContent.jqIframe(".awe-model-"+l.model.cid),a=o.parent();if(a){var n=a.width()?parseInt(a.width()/12):1;AWEContent.jqIframe(".awe-model-"+l.model.cid).resizable({handles:"e",containment:"parent",grid:[n,n],start:function(e,s){s.element.css({padding:0}),t=s.element.parent().parent().parent().height()},resize:function(s,l){var o=l.element.parent().parent().parent();o.height()!=t&&(e(o.get(0)).trigger("resize"),t=o.height()),e(this).css("height","")},stop:function(s,o){var a=o.element.parent().parent().parent(),n=AWEContent.jqIframe(l.el).resizable("option","grid")[0],i=Math.round((o.size.width-o.originalSize.width)/n),c=l.$el.attr("class"),r=AWEContent.Toolbars.responsive.classScreen,d=l.model.get("classes").get(r+"-offset"),u=l.model.get("classes").get(r),m=u+i;d+m>12?m=12-d:1>m&&(m=1),c=c.replace(r+"-"+u,r+"-"+m),l.$el.removeClass().addClass(c).css({width:"",padding:""}),l.model.get("classes").set(r,m),a.height()!=t&&e(a.get(0)).trigger("resize")}}),clearInterval(s)}},100)},afterChangeClassColumn:function(){this.model.get("hasLayout")&&this.model.get("layout").each(function(e,t){e.view.afterChangeClassColumn()}),this.model.get("items").each(function(e,t){e.view.$el.trigger("resize")}),this.autoSetNewRow(),this.refreshColumnGrid()},refreshColumnGrid:function(){AWEContent.Toolbars.responsive.updateColumnResizeGrid()},autoSetNewRow:function(e){var t=this,s=t.model.collection,l=AWEContent.Toolbars.responsive.classScreen;s.each(function(e,t){for(var o=e.get("classes").get(l),a=t-1;a>=0;a--){var n=s.at(a),i=n.view.$el,c=n.get("classes").get(l);"both"==i.css("clear")?(a=-1,o+=c):o+=c}void 0!=i&&(o>12?e.view.$el.css("clear","both"):e.view.$el.css("clear",""))})},generateColumnClasses:function(){var t=[];return e.map(this.model.get("classes").toJSON(),function(e,s){"column"!=s&&t.push(s+"-"+e)}),t.join(" ")},render:function(){var t=this;this.$el.append(this.template()).addClass(this.generateColumnClasses()),this.renderColumnSettings(),this.$el.addClass("awe-model-"+t.model.cid),this.initResizable(),setTimeout(function(){t.renderDefaultColumnClasses(),t.autoSetNewRow();var s=t.model.collection.at(0).view.$el,l=e(">.awe-custom > ul > .js-delete-column",s),o=e(">.awe-custom > ul > .js-split-column",t.el),a=e(">.awe-custom > ul >.col-cus-show-more > ul > .js-toggle-layout",t.el);1==t.model.collection.length?l.addClass("disable"):l.removeClass("disable"),t.$el.hasClass("awe-has-layout")&&a.addClass("disable"),t.$el.hasClass("col-lg-1")&&o.addClass("disable")},50)},destroy:function(t){t.preventDefault();var s=this.$el.parent().parent().parent(),l=s.height(),o=this.$el.siblings().length,a=this.model.collection;if(o){this.model.removePanelView();var n=AWEContent.Panels.column;n.isOpenned&&n.$el.data("model.id")==this.model.cid&&(n.$el.removeAttr("data-model.id"),n.closePanel()),this.model.collection.remove(this.model),this.model.destroy(),this.remove(),setTimeout(function(){a.at(0).view.autoSetNewRow(),s.height()!=l&&s.trigger("resize")},100)}if(1==a.length){var i=a.at(0).view.$el,c=e(">.awe-custom > ul >.js-delete-column",i);c.addClass("disable")}},editColumn:function(){AWEContent.Panels.column.editModel(this.model)},splitColumn:function(t){var s=this.model.get("classes").get("col-lg");if(s>1){var l=e(".awe-col",this.$el.parent()).index(this.$el),o=Math.ceil(s/2),a=s-o,n=new AWEContent.Models.Column({classes:new AWEContent.Models.BootstrapGrid({"col-lg":a,"col-md":a}),items:new AWEContent.Collections.ListItem});this.model.get("classes").set({"col-lg":o,"col-md":o}),this.model.collection.add(n,{at:l+1})}},makeNewRow:function(){var e=AWEContent.Toolbars.responsive.classScreen;if(0!==this.model.collection.indexOf(this.model)&&12!==this.model.get("classes").get(e)){var t=this.model.get("classes").get(e+"-make-row");this.model.get("classes").set(e+"-make-row",!t),this.$el.parents(".awe-section").trigger("resize")}},toggleColumnLayout:function(){if(this.$el.hasClass("awe-has-layout")){var t=new AWEContent.Collections.ListItem,s=e(">.awe-custom > ul >.col-cus-show-more > ul > .js-toggle-layout",this.el);s.removeClass("disable"),this.model.get("layout").each(function(e){e.get("items").each(function(e){t.add(e,{silent:!0})})}),this.model.set("items",t,{silent:!0}),this.model.unset("layout",{silent:!0});var l=new AWEContent.Views.ListItem({collection:t});e(">.awe-col-content",this.$el).prepend(l.$el),e(">.awe-col-content >.awe-col-layout-wrapper",this.$el).remove(),this.$el.removeClass("awe-has-layout"),this.model.set("hasLayout",0),e("> .custom-add-layout",this.$el).remove(),AWEContent.Panels.toolbarPanel.updateSortableColumn(e("> .awe-col-wrapper",l.$el))}else{var o=new AWEContent.Models.Column({settings:new AWEContent.Models.ColumnSettings,classes:new AWEContent.Models.BootstrapGrid,items:new AWEContent.Collections.ListItem}),a=new AWEContent.Collections.ListColumn,n=new AWEContent.Views.ListColumn({collection:a}),s=e(">.awe-custom > ul >.col-cus-show-more > ul > .js-toggle-layout",this.el);s.addClass("disable"),a.add(o),this.model.get("items").each(function(e){o.get("items").add(e,{silent:!0})}),this.model.set("layout",a),this.model.set("hasLayout",1),this.model.unset("items",{silent:!0});var i=new AWEContent.Views.ListItem({collection:o.get("items")});this.$el.addClass("awe-has-layout"),n.$el.removeClass().addClass("awe-col-layout-wrapper clearfix"),e(".awe-col:first > .awe-col-content >.awe-col-wrapper",n.$el).remove(),e(".awe-col:first > .awe-col-content",n.$el).append(i.$el),e("> .awe-col-content",this.el).append(n.$el),this.$el.append('<div class="awe-custom custom-add-layout"><ul><li class="cus-cal-icon"><i class="ic ac-icon-add"></i></li></ul></div>'),e("> .awe-col-content > .awe-col-wrapper",this.$el).remove(),AWEContent.Panels.toolbarPanel.updateSortableColumn(e(".awe-col-wrapper",n.$el))}this.checkBlankColumn()},addColumnToColumnLayout:function(){var e=new AWEContent.Models.BoxModelSettings,t=new AWEContent.Models.Column({settings:new AWEContent.Models.ColumnSettings({boxModelSettings:e}),items:new AWEContent.Collections.ListItem,classes:new AWEContent.Models.BootstrapGrid});this.model.get("layout").add(t)},changeOffset:function(t){var s=e(t.target);if(s=s.hasClass("js-increase-offset")||s.parent().hasClass("js-increase-offset")?s.hasClass("js-increase-offset")?s:s.parent():s.hasClass("js-decrease-offset")?s:s.parent(),!s.hasClass("disabled")){var l=AWEContent.Toolbars.responsive.classScreen,o=this.model.get("classes").get(l+"-offset"),a=0,n=this.$el.attr("class");a=s.hasClass("js-increase-offset")?o+1+this.model.get("classes").get(l)>12?o:o+1:o>0?o-1:0,o!=a&&(n=n.replace(l+"-offset-"+o,l+"-offset-"+a),this.$el.removeClass().addClass(n),this.model.get("classes").set(l+"-offset",a))}},showHideElement:function(){this.model.get("settings").set(AWEContent.Toolbars.responsive.screen,!1),AWEContent.Toolbars.responsive.reInitPanel()},renderDefaultColumnClasses:function(){var t=this,s=t.model.toJSON().classes,l=AWEContent.Toolbars.responsive.classScreen,o=e("> .awe-custom",t.el),a=s[l+"-offset"],n=s[l],i=e(".cus-prev",o),c=e(".cus-next",o),r=e(">.awe-custom > ul > .js-split-column",t.el);a?i.removeClass("disable"):i.addClass("disable"),a+n==12?c.addClass("disable"):c.removeClass("disable"),t.$el.hasClass("col-lg-1")?r.addClass("disable"):r.removeClass("disable")},renderChangeColumnClasses:function(t){var s,l=this,o=l.$el.closest(".awe-section");o.length&&(s=o.index(),e.each(t.changed,function(e,s){var o=e+"-"+t.previousAttributes()[e],a=e+"-"+s;l.$el.removeClass(o).addClass(a)}),l.renderDefaultColumnClasses(),AWEContent.sections.at(s).set("connectSpacingToColumn",!0)),l.afterChangeClassColumn()},renderColumnSettings:function(){var t=this,s=this.model.get("settings").toJSON(),l=e(" >.awe-col-content",this.$el);if(l.addClass(s.customClass).attr("id",s.customID),t.$colOverlay=e('<div class="custom-bg-overlay custom-overlay"></div>'),this.$el.aweImageURL({fid:[s.bgFid],styles:["none"],success:function(e,s,l,o){t.processBackgroundURL(e,s,l,o)}}),s.enableMinHeight&&-1!=s.minHeight){l.css("min-height",s.minHeight+"px");var o=setInterval(function(){e("> .awe-col-wrapper",l).length>0&&(e("> .awe-col-wrapper",l).css("min-height",s.minHeight+"px"),clearInterval(o))},50)}"parallax"==s.bgMode?l.attr("data-parallax",!0):l.attr("data-parallax",!1),l.attr("data-scrolling",s.enableScrolling?!0:!1),AWEContent.jqIframe(" >.awe-col-content",t.el).parallax(),s.enabledBgOverlay&&(l.prepend(t.$colOverlay),t.$colOverlay.css("background-color",s.bgOverlayColor)),l.renderItemDefaultBoxModel(s.boxModelSettings,t.$colOverlay),s.centerVertical&&l.addClass("col-vertical-center"),l.addClass(s.textAlign),t.$el.defaultResponsive(s)},renderColumnContent:function(){var t;if(this.model.get("hasLayout")&&this.model.get("layout").length){var s=this.model.get("layout"),l=new AWEContent.Views.ListColumn({collection:s});l.$el.removeClass().addClass("awe-col-layout-wrapper clearfix"),t=l.$el,this.$el.addClass("awe-has-layout"),this.$el.append('<div class="awe-custom custom-add-layout"><ul><li class="cus-cal-icon"><i class="ic ac-icon-add"></i></li></ul></div>')}else{var o=new AWEContent.Views.ListItem({collection:this.model.get("items")});t=o.$el}e(">.awe-col-content",this.$el).append(t)},renderChangeColumnSettings:function(t){var s=this,l=s.model.toJSON().settings,o=e("> .awe-col-content",s.el),a=e(".custom-bg-overlay",o);e.each(t.changed,function(n,i){switch(s.$el.changeResponsive(n,i),n){case"customID":o.attr("id",l.customID);break;case"customClass":var c=s.model.get("settings").previousAttributes().customClass;o.removeClass(c).addClass(l.customClass);break;case"centerVertical":i?o.addClass("col-vertical-center"):o.removeClass("col-vertical-center");break;case"textAlign":var r=s.model.get("settings").previousAttributes().textAlign;o.removeClass(r).addClass(i);break;case"enableMinHeight":case"minHeight":var d=-1!=l.minHeight?l.minHeight+"px":"",u=l.enableMinHeight;u?e(">.awe-col-wrapper",o).css("min-height",d):e(">.awe-col-wrapper",o).css("min-height","");break;case"heightEqual":var m=t.previousAttributes().heightEqual,h=-1!=i?i+"px":"";m!=i&&e(">.awe-col-wrapper",o).css("min-height",h);break;case"bgColor":case"bgFid":case"bgPosition":s.processBackground(t.toJSON(),o);break;case"bgMode":"parallax"==i?o.attr("data-parallax",!0):o.attr("data-parallax",!1),s.processBackground(t.toJSON(),o);break;case"enableScrolling":i?o.attr("data-scrolling",!0):o.attr("data-scrolling",!1);break;case"enabledBgOverlay":l.enabledBgOverlay?o.prepend(s.$colOverlay):a.remove();break;case"bgOverlayColor":a.css("background",l.bgOverlayColor);break;case"enabledParallax":case"enabledMouseMoveParallax":break;default:o.renderChangeSettingBoxModel(n,i,t,s.$colOverlay)}})},processBackground:function(e,t){var e=e,s="",l="",o="",a="",n=e.bgColor;return e.bgFid>0&&(s="url("+encodeURI(this.model.bgImageURL)+")","parallax"==e.bgMode?(l="",o="fixed",a="50% 0%/cover"):"fullcover"==e.bgMode?(a="center/cover",o=""):(l=e.bgMode,a=e.bgPosition),n+=" "+s+" "+l+" "+o+" "+a),t.css("background",n),n},cloneColumn:function(){var e=this.model.clone(),t=this.$el.index();this.model.collection.add(e,{at:t+1})}}),AWEContent.Collections.ListColumn=Backbone.Collection.extend({model:AWEContent.Models.Column}),AWEContent.Views.ListColumn=Backbone.View.extend({tagName:"div",className:"row",initialize:function(){this.listenTo(this.collection,"add",this.append),this.render()},render:function(){this.collection.each(function(e,t){this.append(e)},this)},append:function(t,s,l){var o=new AWEContent.Views.Column({model:t});t.view=o,l&&void 0!=l.at?o.$el.insertAfter(e(".awe-col:eq("+(l.at-1)+")",this.$el)):this.$el.append(o.$el),AWEContent.Panels.toolbarPanel.updateSortableColumn(e(".awe-col-wrapper",o.$el)),this.$el.closest(".awe-section").trigger("resize")}})}(jQuery);