!function(e){"use strict";window.AWEContent={Models:{},Collections:{},Controllers:{},Panels:{},Views:{},Toolbars:{},Path:{imageStyleURL:"",fileUploadURL:"upload.php",uploadTemplate:"upload.php",templateActionURL:"load-template.php",buildPanel:"panel.php",templateProxy:"html2canvasproxy.php",twitterAPI:"tweet/api/tweet.php",libraryURL:"upload.php",myFileURL:"upload.php",defaultImage:"img/image.png",libraries:{video:{css:[],js:["https://www.youtube.com/iframe_api","js/lib/froogaloop.min.js"]},magnific:{js:["js/lib/magnific-popup.js"],css:["css/magnific-popup.css"]},owlCarousel:{js:["js/lib/owl.carousel/owl.carousel.js"],css:["js/lib/owl.carousel/owl.carousel.css","js/lib/owl.carousel/owl.theme.css","js/lib/owl.carousel/owl.transitions.css"]},googleMap:{js:["https://maps.googleapis.com/maps/api/js?v=3.exp"],css:[]},aceEditor:{js:["js/lib/aceEditor/ace.js","js/lib/aceEditor/mode-html.js","js/lib/aceEditor/theme-twilight.js","js/lib/aceEditor/worker-html.js"],css:[]}}},templateType:1},AWEContent.ajaxUpload=function(t,n,o){if(window.FormData){var i=new FormData,a=new XMLHttpRequest,s=e.now();i.append("awe_file",t),n&&e.map(n,function(e,t){i.append(t,e)}),o.beforeUploadCallback(t,s),a.open("POST",o.uploadURL),a.onload=function(e){o.uploadFinishedCallback(e,t,s)},a.onprogress=function(e){o.uploadProgressCallback(e,t,s)},a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var t=JSON.parse(this.responseText.trim());if(o.uploadSuccessCallback(t,s),t.file.is_new&&AWEContent.Panels.mediaPanel){var n=e('<div class="book-lib">                                    <i class="ic ac-icon-done"></i>                                    <img src="" alt="book">                                    <input type="hidden" name="file_data">                                </div>');e("img",n).attr("src",t.file.file_url),e("input",n).val(JSON.stringify(t.file)),e(".library .books-item",AWEContent.Panels.mediaPanel.$el).prepend(n)}}else console.log("Upload files failed!")}}return a.send(i),!0},AWEContent.mediaValidateFileType=function(t,n){var o=t.split("/");return 0==n.length||o[1]&&-1!=e.inArray(o[1],n)?!0:!1},AWEContent.compressImage=function(e,t,n){t=Math.round(t),n=Math.round(n);for(var o=e.width,i=e.height,a=e.getContext("2d").getImageData(0,0,o,i),s=e.getContext("2d").getImageData(0,0,t,n),r=a.data,l=s.data,d=o/t,c=i/n,p=Math.ceil(d/2),u=Math.ceil(c/2),h=0;n>h;h++)for(var m=0;t>m;m++){for(var C=4*(m+h*t),w=0,f=0,g=0,W=0,b=0,E=0,A=0,v=(h+.5)*c,y=Math.floor(h*c);(h+1)*c>y;y++)for(var P=Math.abs(v-(y+.5))/u,L=(m+.5)*d,S=P*P,M=Math.floor(m*d);(m+1)*d>M;M++){var x=Math.abs(L-(M+.5))/p,j=Math.sqrt(S+x*x);j>=-1&&1>=j&&(w=2*j*j*j-3*j*j+1,w>0&&(x=4*(M+y*o),A+=w*r[x+3],g+=w,r[x+3]<255&&(w=w*r[x+3]/250),W+=w*r[x],b+=w*r[x+1],E+=w*r[x+2],f+=w))}l[C]=W/f,l[C+1]=b/f,l[C+2]=E/f,l[C+3]=A/g}return e.getContext("2d").clearRect(0,0,Math.max(o,t),Math.max(i,n)),e.width=t,e.height=n,e.getContext("2d").putImageData(s,0,0),e},AWEContent.getColumnModelContainItem=function(t){var n,o=t.parents(".awe-col"),i=null;return o=e(o.get().reverse()),o.each(function(t,o){var a=e(o).parent().parent().parent(),s=e("> .awe-section",a.parent()).index(a),r=e("> .awe-col",e(o).parent()).index(e(o));if(i)if(i.get("hasLayout"))i=i.get("layout").at(e(o).index());else{var l=e(o).parents(".awe-obj").first(),d=e("> .awe-obj",l.parent()).index(l),c=i.get("items").at(d);c.hasContentLayout&&(i=c.getContentColumnModel(e(o),r))}else n=AWEContent.sections.at(s),i=n.get("columns").at(r)}),i},AWEContent.Library={loadedLibraries:[],addCSSFiles:function(t){e.each(t,function(){var t=e('<link type="text/css" rel="stylesheet" href=""/>');t.attr("href",this),AWEContent.jqIframe("head").append(t)})},addJSFiles:function(t,n,o){var i,a=this,s=0,r=0;this.doc.oldWrite=this.doc.write,this.doc.write=function(e){var t=new DOMParser,n=t.parseFromString(e,"text/xml"),o=n.firstChild,i=a.doc.createElement("script");i.src=o.getAttribute("src"),i.type="text/javascript",a.doc.getElementsByTagName("head")[0].appendChild(i),a.doc.write=a.doc.oldWrite},e.each(t,function(){var e=a.doc.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",this),e.onload=function(e){s++},a.doc.getElementsByTagName("head")[0].appendChild(e)}),i=setInterval(function(){return r++,r>1e3?void clearInterval(i):void(t.length==s&&(clearInterval(i),o&&o(),a.loadedLibraries.push(n)))},500)},addLibrary:function(t,n,o){var i=this;if(this.doc=o?document:AWEContent.documentIframe,!this[t+"Loading"]&&AWEContent.Path.libraries[t])i[t+"Loading"]=!0,this.addCSSFiles(AWEContent.Path.libraries[t].css),this.addJSFiles(AWEContent.Path.libraries[t].js,t,n);else if(n)var a=setInterval(function(){-1!=e.inArray(t,i.loadedLibraries)&&(clearInterval(a),n())},300)},reset:function(){var t=this;e.each(this.loadedLibraries,function(){t[this+"Loading"]=!1}),this.loadedLibraries=[]}},AWEContent.Models.BoxModelSettings=Backbone.RelationalModel.extend({defaults:{enabledCustomBorder:0,enabledConstraintBorder:1,borderTop:"0 solid",borderRight:"0 solid",borderBottom:"0 solid",borderLeft:"0 solid",enabledCustomBorderRadius:0,enabledConstraintBorderRadius:1,borderRadiusUnit:"px",borderRadiusTopLeft:0,borderRadiusTopRight:0,borderRadiusBottomLeft:0,borderRadiusBottomRight:0,enabledCustomPadding:0,enabledConstraintPadding:1,paddingUnit:"px",paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,enabledCustomMargin:0,enabledConstraintMargin:1,marginUnit:"px",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0}}),AWEContent.createSectionFromTemplate=function(t){if(t){t.settings.boxModelSettings=new AWEContent.Models.BoxModelSettings(t.settings.boxModelSettings);var n=new AWEContent.Models.SectionSettings(t.settings),o=new AWEContent.Collections.ListColumn;return e.each(t.columns,function(e,t){o.add(AWEContent.createColumnFromTemplate(t))}),new AWEContent.Models.Section({settings:n,columns:o})}return null},AWEContent.createColumnFromTemplate=function(t){var n,o=new AWEContent.Models.BootstrapGrid(t.classes),i=new AWEContent.Models.BoxModelSettings(t.settings.boxModelSettings),a=null;if(t.settings.boxModelSettings=i,n=new AWEContent.Models.ColumnSettings(t.settings),t.hasLayout){var s=new AWEContent.Collections.ListColumn;e.each(t.layout,function(e,t){s.add(AWEContent.createColumnFromTemplate(t))}),a=new AWEContent.Models.Column({classes:o,hasLayout:1,layout:s,settings:n})}else{var r=new AWEContent.Collections.ListItem;e.each(t.items,function(e,t){var n=null;AWEContent.Controllers[t.machine_name]&&(n=AWEContent.Controllers[t.machine_name].createItemModel(t),n&&r.add(n))}),a=new AWEContent.Models.Column({classes:o,settings:n,items:r,hasLayout:0})}return a};var t,n=function(t,n){var o={sections:[],pageURL:"#",sectionsWrapper:"#awe-sections-wrapper",pageWrapper:"body",sectionAlwaysFluid:0,disableAuto:!0,closeBuilderCallback:function(){}};this.opts=e.extend({},o,n),this.$builderWrap=null,this.$iframe=null,this.sections=null,this.sectionsView=null,this.frameReady=!1,this.panelsReady=!1,this.initialize()};n.prototype={constructor:AWEContent,initialize:function(){var t=this;e("#awecontent-wrapper").length?(this.$builderWrap=e("#awecontent-wrapper"),this.$iframe=e("> .awe-buildzone > iframe",this.$builderWrap)):(this.$builderWrap=e('<div id="awe-preloader">                        <div class="inner">                            <div class="clock">                                <div class="minute"></div><div class="house"></div>                            </div>                            <span>Now Loading.</span>                        </div>                    </div>                    <div id="awecontent-wrapper" class="awecontent-wrapper">                        <div class="awe-buildzone"><iframe></iframe></div>                        <div class="awe-panel"><div class="panel-list"></div></div>                    </div>'),e("body").prepend(this.$builderWrap),this.$iframe=e("> .awe-buildzone > iframe",this.$builderWrap).attr("src",this.opts.pageURL).load(function(){t.onFrameLoad()}),this.initPanels(),this.$builderWrap.bind("builderClose",function(e,n){t.opts.disableAuto&&t.hide(),n?t.opts.closeBuilderCallback(AWEContent.sections.toJSON()):t.opts.closeBuilderCallback(!1)}).bind("builderReady",function(){e("#awe-preloader").hide(),e(window).trigger("aweBuilderOpen")}),e(window).resize(function(){AWEContent.iframe.height(e(window).height())})),this.show()},show:function(){this.$builderWrap.show(),e(window).scroll(function(){e(".list-template-wrapper",AWEContent.Toolbars.template.$el).trigger("mouseenter")}),window.addEventListener("beforeunload",this.closePage)},hide:function(){e(".awe-panel .opened .toggle-build").trigger("click"),this.$builderWrap.hide(),window.removeEventListener("beforeunload",this.closePage),e(window).unbind("scroll")},onFrameLoad:function(){AWEContent.iframe=this.$iframe,AWEContent.contentIframe=AWEContent.iframe.contents(),AWEContent.windowIframe=AWEContent.iframe[0].contentWindow,AWEContent.documentIframe=AWEContent.iframe[0].contentWindow.document,AWEContent.jqIframe=AWEContent.windowIframe.jQuery,AWEContent.$pageWrapper=AWEContent.contentIframe.find(this.opts.pageWrapper),AWEContent.$sectionsWrapper=AWEContent.contentIframe.find(this.opts.sectionsWrapper),AWEContent.alwaysFluid=this.opts.sectionAlwaysFluid,AWEContent.alwaysFluid?AWEContent.contentIframe.find("body").addClass("awe-section-100"):AWEContent.contentIframe.find("body").removeClass("awe-section-100"),AWEContent.$pageWrapper.addClass("awe-page-wrapper"),this.initSections(),AWEContent.panelsOpened=0,e(window).trigger("resize"),this.frameReady=!0,this.$builderWrap.trigger("builderReady"),e(AWEContent.iframe.contents()).scroll(function(){e(window).trigger("scroll")})},setPageUrl:function(e){this.opts.pageURL=e,this.$iframe.attr("src",e)},setOption:function(t){this.opts=e.extend(this.opts,t)},setSectionData:function(e){this.opts.sections=e,this.setPageUrl(this.opts.pageURL)},activeBuilder:function(t){("array"==e.type(t)||t instanceof AWEContent.Collections.ListSection)&&this.setSectionData(t),this.show()},initPanels:function(){AWEContent.Panels.toolbarPanel=new AWEContent.Views.ToolbarPanel,e(".awe-panel",this.$builderWrap).prepend(AWEContent.Panels.toolbarPanel.$el),AWEContent.Panels.section=new AWEContent.Views.SectionPanel,AWEContent.Panels.column=new AWEContent.Views.ColumnPanel,AWEContent.Panels.fontPanel=new AWEContent.Views.FontPanel,AWEContent.Panels.listIconPanel=new AWEContent.Views.ListIconsPanel,AWEContent.Panels.mediaPanel=new AWEContent.Views.MediaPanel,AWEContent.Panels.customAttributesPanel=new AWEContent.Views.AttributesPanel,AWEContent.Panels.customAnimationsPanel=new AWEContent.Views.AnimationPanel,AWEContent.templateDialog=new AWEContent.Views.TemplateDialog},initSections:function(){var t=this;if(this.resetBuilder(),this.opts.sections instanceof AWEContent.Collections.ListSection)this.sections=this.opts.sections;else{var n=[];if(this.opts.sections.length)e.each(this.opts.sections,function(e,t){n.push(AWEContent.createSectionFromTemplate(t))});else{var o=new AWEContent.Models.BoxModelSettings,i=new AWEContent.Models.Column({items:new AWEContent.Collections.ListItem,settings:new AWEContent.Models.ColumnSettings({boxModelSettings:o}),classes:new AWEContent.Models.BootstrapGrid}),a=new AWEContent.Models.BoxModelSettings,s=new AWEContent.Models.Section({columns:new AWEContent.Collections.ListColumn([i]),settings:new AWEContent.Models.SectionSettings({boxModelSettings:a})});n.push(s)}this.sections=new AWEContent.Collections.ListSection(n)}if(AWEContent.sections=this.sections,AWEContent.sectionsView=this.sectionsView=new AWEContent.Views.ListSection({collection:this.sections,el:AWEContent.$sectionsWrapper.get(0)}),AWEContent.Panels.toolbarPanel.updateSortableColumn(),!AWEContent.ajaxPanels){var r=[];e.map(AWEContent.Panels,function(n,o){AWEContent.Controllers[o]&&!AWEContent.Controllers[o].existingElement&&e("#all-element ul.all-element",t.$el).append(AWEContent.Controllers[o].$el),r.push({name:o,data:n.buildPanel()})})}},resetBuilder:function(){this.sections=null,this.frameReady=!1,AWEContent.Library.reset(),this.sectionsView&&this.sectionsView.$el.empty()},closePage:function(e){var t="All change on page builder will be lost permanently.";return(e||window.event).returnValue=t,t}},e.fn.awecontent=function(o,i){if(this.is("body")){if("string"==typeof o){var a=Array.prototype.slice.call(arguments,1);if(!t)throw new Error("Error: cannot call methods on awecontent prior to initialization;");t[o];switch(o){case"setPageURL":if(!a[0])throw new Error("PageURL is not set.");if("string"!=e.type(a[0]))throw new Error("PageURL is not a string.");t.setPageUrl(a[0]);break;case"option":var s={};if("object"==e.type(a[0]))s=a[0];else{if("string"!=e.type(a[0])||void 0==a[1])throw Error("Can not set option value");s[a[0]]=a[1]}t.setOption(s);break;case"setSectionsData":if(a[0]){if(!("array"==e.type(a[0])||a[0]instanceof AWEContent.Collections.ListSection))throw new Error("Section data is not array. This type of sections data must be array or AWEContent.Collections.ListSection object.");t.setSectionData(a[0])}else t.setSectionData([]);break;case"openBuilder":t.activeBuilder(a[0]);break;case"disable":t.hide();break;default:throw new Error("AWEContentBuilder: no such method: '"+o+"'")}return this}return t=new n(e(this),o),this}throw new Error("Selected element is not body tag. This plugin accepts body tag only.")}}(jQuery);